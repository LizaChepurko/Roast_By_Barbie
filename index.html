<!doctype html>
<html lang="he">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <title>Barbie Roast Chat</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-pink: #ec4899;
      --bg-pink: #fbcfe8;
      --bubble-white: #ffffff;
      --text-main: #4a4a4a;
    }

    * { box-sizing: border-box; }
    
    html {
        height: 100%;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(180deg, #ffe4f2 0%, #fda4d6 100%);
      margin: 0;
      padding: 0;
      
      /* 专拽 驻转专 注 : */
      height: 100vh; /* Fallback */
      height: 100dvh; /* Dynamic Viewport Height - 转 转 注爪 砖专转 转转 */
      
      display: flex;
      flex-direction: column;
      overflow: hidden; /* 注  砖  注, 专拽 爪'  */
      
      /* 转砖转 -Notch 砖 驻 */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* --- Header --- */
    /* 转 转 -sticky.  砖  , 专 转 砖专 注 */
    header {
      text-align: center;
      padding: 15px 10px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      flex-shrink: 0; /* 注 专 转抓 */
      z-index: 10;
    }

    h2 {
      font-family: 'Pacifico', cursive;
      font-size: 2rem;
      margin: 0;
      color: #d61c6e;
      text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
    }

    .subtitle {
      font-size: 0.8rem;
      color: #9d3866;
      margin-top: 5px;
      opacity: 0.8;
    }

    /* --- Chat Area --- */
    #chat {
      flex-grow: 1; /* 拽 转  拽 驻  专 转转 拽住 */
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      
      /*  驻转 专拽 专  */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch; /*  拽 驻 */
      
      padding: 16px;
      padding-bottom: 20px; 
      
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .msg-row {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      max-width: 100%;
    }

    .msg-row.me {
      flex-direction: row-reverse;
      align-self: flex-end;
    }

    .msg-row.bot {
      align-self: flex-start;
    }

    .avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background-color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }

    .bot .avatar { color: #d61c6e; background: #fff0f7; }
    .me .avatar { color: white; background: #d61c6e; }

    .msg-bubble {
      padding: 12px 16px;
      border-radius: 20px;
      line-height: 1.4;
      font-size: 15px;
      position: relative;
      word-wrap: break-word;
      max-width: 80%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .me .msg-bubble {
      background-color: var(--primary-pink); 
      color: white;
      border-bottom-right-radius: 4px;
    }

    .bot .msg-bubble {
      background-color: var(--bubble-white);
      color: var(--text-main);
      border-bottom-left-radius: 4px;
    }

    /* --- Typing Indicator --- */
    .typing-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      padding: 5px 0;
      min-width: 40px;
    }

    .dot {
      width: 6px;
      height: 6px;
      background-color: #d61c6e;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .dot:nth-child(1) { animation-delay: -0.32s; }
    .dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    /* --- Input Area --- */
    /* 转 转 -fixed.  注砖 拽 注 驻拽住 */
    .input-container {
      width: 100%;
      flex-shrink: 0; /* 砖 转抓 */
      padding: 10px 16px 16px 16px; /* 拽爪转 转专 专  */
      
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;

      /* 专 砖转 转砖 砖注转 注转 专 */
      background: linear-gradient(to top, rgba(253, 164, 214, 1) 40%, rgba(253, 164, 214, 0));
      z-index: 20;
    }

    form {
      width: 100%;
      max-width: 600px;
      background: white;
      padding: 6px;
      border-radius: 50px;
      display: flex;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(214, 28, 110, 0.15);
      align-items: center;
    }

    input {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 50px;
      font-size: 16px; /*  16 注   驻 */
      outline: none;
      color: #333;
      font-family: 'Quicksand', sans-serif;
    }

    input::placeholder { color: #d4a5b9; }

    button {
      width: 42px;
      height: 42px;
      border: none;
      border-radius: 50%;
      background: var(--primary-pink);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      flex-shrink: 0;
    }
    
    button:hover { transform: scale(1.05); background: #be185d; }
    button:active { transform: scale(0.95); }

    button svg {
      fill: white;
      width: 20px;
      height: 20px;
      margin-left: 2px;
    }
  </style>
</head>
<body>

  <header>
    <h2>Roast By Barbie </h2>
    <div class="subtitle">Warning: She's plastic, fantastic, and brutal.</div>
  </header>

  <div id="chat">
    <div class="msg-row bot">
      <div class="avatar">B</div>
      <div class="msg-bubble">Ugh, is that what you decided to wear today? Tragic. Im here to serve looks and destroy egos, and you look like an easy target. What do you have to say for yourself? </div>
    </div>
  </div>

  <div class="input-container">
    <form id="form">
      <input id="input" placeholder="Write an insult (if you dare)..." autocomplete="off" />
      <button type="submit" aria-label="Send">
        <svg viewBox="0 0 24 24">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
        </svg>
      </button>
    </form>
  </div>

  <script type="module">
    import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

    const SPACE_URL = "https://liza12102000-barbieinsults.hf.space/";

    const chatEl = document.getElementById("chat");
    const form = document.getElementById("form");
    const input = document.getElementById("input");

    function addMsg(text, who) {
      const row = document.createElement("div");
      row.className = `msg-row ${who}`;

      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.innerHTML = who === "bot" ? "B" : '<svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>';

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble";
      if(text) bubble.textContent = text;
      
      row.appendChild(avatar);
      row.appendChild(bubble);

      chatEl.appendChild(row);
      

      setTimeout(() => {
        row.scrollIntoView({ behavior: "smooth", block: "end" });
      }, 50);

      return bubble;
    }

    const client = await Client.connect(SPACE_URL);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const message = input.value.trim();
      if(!message) return;

      addMsg(message, "me");
      input.value = "";

      const placeholderBubble = addMsg("", "bot");
      placeholderBubble.innerHTML = `
        <div class="typing-indicator">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      `;

      try {
        const result = await client.predict("/respond", [message]);
        const comeback = Array.isArray(result.data) ? result.data[0] : result.data;
        
        placeholderBubble.innerHTML = "";
        placeholderBubble.textContent = (comeback ?? "").toString().trim() || "(no answer)";
      } catch (err) {
        console.error(err);
        placeholderBubble.textContent = "Barbie broke a nail (error) ";
      }
    });
  </script>
</body>
</html>